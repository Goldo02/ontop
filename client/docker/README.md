# Ontop-endpoint

## Introduction

The image `ontop/ontop-endpoint` is the standard solution for setting up Ontop SPARQL endpoint. 
One can either use `ontop/ontop-endpoint` directly, or create a dedicated image based on this image.

## Environment variables
Here is a list of environment variables. Most of them directly correspond to arguments of the CLI `ontop-endpoint`command. Please refer to [its documentation page for more details about these arguments](https://ontop-vkg.org/guide/cli.html#ontop-endpoint). All optional settings have reasonable defaults. Boolean flags can be enabled by setting the corresponding variable to any value (even empty) different from `false`. Invalid settings are reported via `WARNING` (non-fatal) or `ERROR` (fatal) messages.

### Core Configuration

- **`ONTOP_MAPPING_FILE`** *(file path, **required**)* - Specifies the mandatory mapping file in R2RML (.ttl) or in Ontop native format (.obda). Corresponds to the argument `--mapping`.
- **`ONTOP_PROPERTIES_FILE`** *(file path, optional)* - Specifies the properties file supplying further Ontop [configuration properties](https://ontop-vkg.org/guide/advanced/configuration.html). Corresponds to the argument `--properties`.
- **`ONTOP_ONTOLOGY_FILE`** *(file path, optional)* - Specifies the ontology file in any supported RDF/OWL format. Corresponds to the argument `--ontology`.
- **`ONTOP_XML_CATALOG_FILE`** *(file path, optional)* - Specifies the [XML Catalog file](https://protegewiki.stanford.edu/wiki/Importing_Ontologies_in_P41#Protege_and_XML_Catalogs) (e.g. catalog-v001.xml generated by Protege) for mapping URLs of ontologies imported via `owl:imports` statements to paths of local files, to avoid downloading them from the Web (if feasible). Corresponds to the argument `--xml-catalog`.
- **`ONTOP_DB_USER`** *(string, optional)* - Specifies the DB user name, overriding any `jdbc.user` setting in the properties file. Corresponds to the argument `--db-user`. Added in 4.1.0.
- **`ONTOP_DB_USER_FILE`** *(file path, optional)* - Alternative to `ONTOP_DB_USER` that loads the DB user name from a separate file (e.g., a Docker secret) and assigns it to the argument `--db-user`. Introduced in 4.1.0.
- **`ONTOP_DB_PASSWORD`** *(string, optional)* - Specifies the DB user password, overriding any `jdbc.password` setting in the properties file. Corresponds to the argument `--db-password`. Added in 4.1.0.
- **`ONTOP_DB_PASSWORD_FILE`** *(file path, optional)* - Alternative to `ONTOP_DB_PASSWORD` that loads the DB user password from a separate file (e.g., a Docker secret) and assigns it to the argument `--db-password`. Introduced in 4.1.0.
- **`ONTOP_DB_URL`** *(string, optional)* - Specifies the DB JDBC URL, overriding any `jdbc.url` setting in the properties file. Corresponds to the argument `--db-url`. Added in 4.1.0.
- **`ONTOP_DB_URL_FILE`** *(file path, optional)* - Alternatove to `ONTOP_DB_URL` that loads the DB JDBC URL from a separate file (e.g., a Docker secret) and assigns it to the argument `--db-url`. Introduced in 4.1.0.
- **`ONTOP_DB_DRIVER`** *(string, optional)* - Specifies the DB JDBC driver class name, overriding any `jdbc.driver` setting in the properties file. Corresponds to the argument `--db-driver`. Added in 4.2.0.
- **`ONTOP_DB_METADATA_FILE`** *(file path, optional)* - Specifies a user-supplied DB metadata file. Corresponds to the argument `--db-metadata`. Added in 4.1.0.
- **`ONTOP_CONSTRAINT_FILE`** *(file path, optional)* - Specifies a user-supplied DB constraint file. Corresponds to the argument `--constraint`.
- **`ONTOP_VIEW_FILE`** *(file path, optional)* - Specifies a user-supplied view file. Corresponds to the argument `--ontop-views`. Added in 4.1.0.
- **`ONTOP_CORS_ALLOWED_ORIGINS`** *(string, optional)* - Specifies the value of the `Access-Control-Allow-Origin` [response header](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing#Response_headers). Corresponds to the argument `--cors-allowed-origins`.

  *Note: suggest configuring DB settings via environment variable (possibly using their `_FILE` variants) to avoid storing or exposing sensitive data such as DB passwords.*

### Ontop Portal

- **`ONTOP_PORTAL_FILE`** *(file path, optional)* - Specifies the TOML portal configuration file ([example](https://ontop-vkg.org/examples/example-portal.toml)) with portal title and SPARQL queries organized in tabs. Corresponds to the argument `--portal`.
- **`ONTOP_DISABLE_PORTAL_PAGE`** *(boolean flag, optional)* - Disables the Ontop portal. Corresponds to the argument `--disable-portal-page`. Added in 4.2.0.

  *Note: the Ontop portal web UI is enabled by default at `http://localhost:8080/` (container address) with no configured SPARQL query and the possibility for users to run arbitrary SPARQL queries.*

### Predefined Queries Endpoint

- **`ONTOP_PREDEFINED_CONFIG`** *(file path, optional)* - Specifies the [config file](https://ontop-vkg.org/guide/advanced/predefined.html#configuration) for predefined queries. Corresponds to the argument `--predefined-config`.
- **`ONTOP_PREDEFINED_QUERIES`** *(file path, optional)* - Specifies the predefined queries [SPARQL queries file](https://ontop-vkg.org/guide/advanced/predefined.html#predefined-queries) for predefined queries. Corresponds to the argument `--predefined-queries`.
- **`ONTOP_CONTEXTS`** *(file path, optional)* - Specifies the [file containing JSON-LD contexts](https://ontop-vkg.org/guide/advanced/predefined.html#cache-for-the-json-ld-contexts) for predefined queries. Corresponds to the argument `--contexts`.

  *Note: `ONTOP_PREDEFINED_CONFIG` and `ONTOP_PREDEFINED_QUERIES` must be jointly set to enable the predefined queries endpoint (disabled by default).*

### Ontology Download Endpoint

- **`ONTOP_ENABLE_DOWNLOAD_ONTOLOGY`** *(boolean flag, optional)* - Enables `/ontology` endpoint (HTTP GET) that allows user to download the ontology as a plain text file. Corresponds to the argument `--enable-download-ontology`. Added in 4.2.0.

### Lazy or Delayed Initialization

- **`ONTOP_LAZY_INIT`** *(boolean flag, optional)* - Postpones Ontop initialization at first query. Corresponds to the argument `--lazy`.
- **`ONTOP_WAIT_FOR`** *(string, optional)* - Waits for zero or more space-separated `hostname:port` (e.g., the DBMS port) to be reachable before starting Ontop. Added in 5.0.0.
- **`ONTOP_WAIT_TIMEOUT`** *(number, optional)* - Specifies the maximum number of seconds to wait for the port(s) to be reachable. Added in 5.0.0.

  *Note: Ontop requires accessing the DBMS during initialization. These settings either postpone initialization or help making sure the DBMS is accessible, so to prevent Ontop startup failures.*

### Logging, Debugging, JMX and JVM tuning

- **`ONTOP_DEV_MODE`** *(boolean flag, optional)* - Automatically restarts Ontop when a configuration file changes. Corresponds to the argument `--dev`.
- **`ONTOP_LOG_ENTRYPOINT`** *(boolean flag, optional)* - Logs all the commands of Ontop Docker entrypoint script (`/opt/ontop/entrypoint.sh`), for startup debugging. Added in 5.0.0.
- **`ONTOP_LOG_CONFIG`** *(file path, optional)* - Specifies the `logback.xml` file to use for configuring logging. Default is `/opt/ontop/log/logback.xml` (within the container). Added in 5.0.0.
- **`ONTOP_LOG_LEVEL`** *(enum, optional)* - Selects log verbosity when using the default `logback.xml` file. Possible values (from no logs to every message logged): `off`, `error`, `warn`, `info`, `debug`, `trace`, `all`. Default is `info`. Added in 5.0.0.
- **`ONTOP_DEBUG`** *(boolean flag, optional)* - Legacy configuration corresponding to setting the log level to `debug`.
- **`ONTOP_CONFIGURE_JMX`** *(boolean flag, optional)* - Configures JMX on port 8686 of the container. Map it to a host port to debug Ontop via a JMX client (e.g., [visualvm](https://visualvm.github.io/)). Added in 5.0.0.
- **`ONTOP_FILE_ENCODING`** *(string, optional)* - File encoding. Default is `UTF-8`. Added in 4.1.0.
- **`ONTOP_JAVA_ARGS`** *(string, optional)* - Allows to set arbitrary Java arguments, such as the ones for memory and garbage collector configuration (e.g., `-Xms512M -Xmx512M`). Added in 4.1.0.

  *Note: consider enabling `ONTOP_DEV_MODE` during development and `ONTOP_CONFIGURE_JMX` for monitoring in production.*

### Docker Healthchecks

- **`ONTOP_HEALTHCHECK`** *(enum, optional)* - Selects the healtcheck strategy: `process` to check Ontop process state; `port` to check Ontop port reachability; `query` to send a probe SPARQL query. Default is `port` for Ontop `endpoint` command, `process` otherwise. Healthchecks are run every 5 seconds or less frequently for successful probe queries (to reduce overhead). Added in 5.0.0.
- **`ONTOP_HEALTHCHECK_QUERY`** *(string, optional)* - Specifies the probe SPARQL query. Default is `SELECT * {}` that just checks that Ontop is working and can reach the database. Added in 5.0.0.
- **`ONTOP_HEALTHCHECK_QUERY_INTERVAL`** *(number, optional)* - Specifies a longer interval between probe query executions when the previous query was successful. Default is 60 seconds. During this interval, simpler port checks are executed (every 5 seconds). Added in 5.0.0.

  *Note: healtchecks are enabled by default and are further configurable via `docker run` [options](https://docs.docker.com/engine/reference/run/#healthcheck) and `docker-compose.yml` [directives](https://docs.docker.com/compose/compose-file/compose-file-v3/#healthcheck).*

## Tutorial

A tutorial is provided on the Ontop Website: https://ontop-vkg.org/tutorial/endpoint/endpoint-docker
